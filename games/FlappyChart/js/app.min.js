var __extends=this&&this.__extends||function(a,t){function e(){this.constructor=a}for(var i in t)t.hasOwnProperty(i)&&(a[i]=t[i]);a.prototype=null===t?Object.create(t):(e.prototype=t.prototype,new e)},FlappyChart;!function(a){var t;!function(a){a[a.STANBY=1]="STANBY",a[a.RUNNING=2]="RUNNING",a[a.GAMEOVER=3]="GAMEOVER"}(t||(t={}));var e=function(a){function t(){a.call(this)}return __extends(t,a),t.prototype.preload=function(){game.load.image("progressbar","assets/images/progressbar.png"),game.load.image("hari","assets/images/hari.png")},t.prototype.create=function(){game.state.start("LoadingState",!0,!1)},t}(Phaser.State);a.BootState=e;var i=function(a){function t(){a.call(this),this.preloadBar=null}return __extends(t,a),t.prototype.preload=function(){this.preloadBar=game.add.image(0,game.world.centerY,"progressbar"),this.preloadBar.position.x=game.world.width/2-this.preloadBar.width/2;var a=game.add.image(game.world.centerX,game.world.centerY-160,"hari");a.anchor.set(.5);var t=game.add.text(0,game.world.centerY-64,"JUST A MOMENT, PLEASE",{font:"bold 16px Arial Black",fill:"#fff",boundsAlignH:"center",boundsAlignV:"middle"});t.position.x=game.world.width/2-this.preloadBar.width/2,t.stroke="#de77ae",t.strokeThickness=8,t.setShadow(2,2,"#333333",2,!0,!1);var e=game.add.text(0,game.world.centerY+128,"もう少々お待ちください",{font:"bold 16px Arial Black",fill:"#fff",boundsAlignH:"center",boundsAlignV:"middle"});e.position.x=game.world.width/2-this.preloadBar.width/2,e.stroke="#de77ae",e.strokeThickness=8,e.setShadow(2,2,"#333333",2,!0,!1),game.load.setPreloadSprite(this.preloadBar),game.load.image("ground","assets/images/ground.png"),game.load.image("building","assets/images/building.png"),game.load.image("grid","assets/images/grid.png"),game.load.image("board","assets/images/board.png"),game.load.image("woman","assets/images/woman.png"),game.load.image("asktaps","assets/images/asktaps.png"),game.load.image("areyouhappy","assets/images/areyouhappy.png"),game.load.image("monthcard","assets/images/monthcard.png"),game.load.image("flappychartlogo","assets/images/flappychartlogo.png"),game.load.image("block","assets/images/block.png");for(var i=0;5>i;i++)game.load.image("cluster"+i,"assets/images/cluster"+i+".png");game.load.spritesheet("player","assets/images/primeminister.png",25,53),game.load.spritesheet("smoke","assets/images/smoke.png",64,32),game.load.audio("explosion1",["assets/audio/explosion1.mp3","assets/audio/explosion1.ogg"]),game.load.audio("impact1",["assets/audio/impact1.mp3","assets/audio/impact1.ogg"]),game.load.audio("impact2",["assets/audio/impact2.mp3","assets/audio/impact2.ogg"]),game.load.audio("jump",["assets/audio/jump.mp3","assets/audio/jump.ogg"]),game.load.audio("passed1",["assets/audio/passed1.mp3","assets/audio/passed1.ogg"]),game.load.audio("start1",["assets/audio/start1.mp3","assets/audio/start1.ogg"]),game.load.audio("surprise1",["assets/audio/surprise1.mp3","assets/audio/surprise1.ogg1"]),game.load.audio("back",["assets/audio/back.mp3","assets/audio/back.ogg1"]),game.load.audio("fall",["assets/audio/fall.mp3","assets/audio/fall.ogg1"]),game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0,game.scale.forceOrientation(!1,!1)},t.prototype.create=function(){this.preloadBar.cropEnabled=!1,game.state.start("GameState",!0,!1)},t}(Phaser.State);a.LoadingState=i;var s=function(a){function e(){a.call(this),this.isShaked=!1,this.isBlink=!1,this.indexOfDrawStart=0}return __extends(e,a),e.prototype.preload=function(){},e.prototype.create=function(){this.score=0,this.mode=t.STANBY,game.world.setBounds(0,0,480,480);var a=50,e=0,i=-a,s=game.world.width,r=game.world.height+2*a;this.highscore=+localStorage.getItem("highscore")||5e3,this.uphs=+localStorage.getItem("uphs")||0,game.world.setBounds(e,i,s,r),game.world.camera.position.set(0),this.background=game.add.tileSprite(0,0,480,480,"grid"),this.background.alpha=.2,this.arrayOfObstacles=[];for(var o=0;10>o;o++){var h=game.add.sprite(game.world.width-47+150*o,game.rnd.integerInRange(-200,100),"building");h.anchor.set(.5),game.physics.arcade.enable(h),h.body.allowGravity=0,h.body.immovable=!0;var l=game.add.sprite(0,game.world.height+game.rnd.integerInRange(0,80),"building");l.anchor.set(.5),game.physics.arcade.enable(l),l.body.allowGravity=0,l.body.immovable=!0,h.addChild(l);var d=game.add.bitmapData(40,game.world.height);d.ctx.beginPath(),d.ctx.rect(0,0,40,game.world.height),d.ctx.fillStyle="#ff0000",d.ctx.fill();var p=game.add.sprite(0,0,d);p.anchor.set(.5),p.position.y=game.world.height/2,game.physics.arcade.enable(p),p.alpha=0,p.body.allowGravity=0,p.body.immovable=!0,h.addChild(p),this.arrayOfObstacles.push(h)}this.arrayOfSmog=[];for(var o=0;o<this.arrayOfObstacles.length;o++){var n=game.add.sprite(0,0,"smoke");n.anchor.set(.5),n.animations.add("smog"),n.animations.play("smog",10,!0),n.kill(),this.arrayOfSmog.push(n)}if(this.months=0,this.monthcard=game.add.image(game.world.width-128,64,"monthcard"),this.monthcard.anchor.set(.5),this.monthcard.position.x=64,this.monthcard.position.y=48,this.monthcard.alpha=0,this.hudMonth=game.add.text(0,0,"0",{font:"20px Arial",fill:"#000"}),this.hudMonth.anchor.set(.5),this.hudMonth.position.y=15,this.monthcard.addChild(this.hudMonth),this.graphics_arrow=game.add.graphics(0,0),this.graphics_arrow_head=game.add.graphics(0,0),this.player=game.add.sprite(game.world.centerX,game.world.height-216,"player"),game.physics.arcade.enable(this.player),this.player.body.collideWorldBounds=!0,this.player.anchor.set(.5),this.player.frame=3,this.player.scale.x=3,this.player.scale.y=3,this.player.smoothed=!1,this.asktaps=game.add.sprite(this.player.position.x+84,this.player.position.y-64,"asktaps"),this.asktaps.anchor.set(.5),this.areyouhappy=game.add.sprite(this.player.position.x+84,this.player.position.y-64,"areyouhappy"),this.areyouhappy.anchor.set(.5),1==this.uphs?(this.asktaps.alpha=0,this.player.addChild(this.asktaps)):(this.areyouhappy.alpha=0,this.player.addChild(this.areyouhappy)),this.asktapsTimer=game.time.create(!1),this.asktapsTimer.loop(500,this.updateAsktaps,this),this.asktapsTimer.start(),this.ground=game.add.tileSprite(0,448,480,32,"ground"),game.physics.arcade.enable(this.ground),this.ground.body.allowGravity=0,this.ground.body.immovable=!0,game.physics.startSystem(Phaser.Physics.ARCADE),this.redFlash=game.add.graphics(0,0),this.redFlash.beginFill(16711680,1),this.redFlash.drawRect(-50,-50,game.world.width+50,game.world.height+50),this.redFlash.alpha=0,this.speedOfRotation=1,this.grayout=game.add.graphics(0,0),this.grayout.beginFill(0,1),this.grayout.drawRect(-50,-50,game.world.width+50,game.world.height+50),this.grayout.alpha=0,game.stage.backgroundColor="#00007f",game.input.onTap.add(this.tapped,this),this.arrayOfTracking4DisplayPosX=[],this.arrayOfTracking4DisplayPosY=[],this.indexOfDrawStart=0,this.dummyScoreBoard=game.add.graphics(0,0),this.board=game.add.sprite(0,0,"board"),this.graphbar=game.add.graphics(0,0),this.graphbar_arrowHead=game.add.graphics(0,0),this.board.anchor.set(.5),this.board.smoothed=!1,this.board.position.x=game.world.centerX,this.board.position.y=game.world.centerY,this.dummyScoreBoard.addChild(this.board),this.dummyScoreBoard.addChild(this.graphbar),this.dummyScoreBoard.addChild(this.graphbar_arrowHead),this.dummyScoreBoard.alpha=0,this.woman=game.add.sprite(0,0,"woman"),this.woman.anchor.set(.5),this.woman.smoothed=!1,this.woman.position.x=game.world.centerX,this.woman.position.y=game.world.centerY,this.woman.alpha=0,this.flappychartlogo=game.add.sprite(game.world.centerX,128,"flappychartlogo"),this.flappychartlogo.anchor.set(.5),this.explosion1=game.add.audio("explosion1"),this.passed1=game.add.audio("passed1"),this.impact1=game.add.audio("impact1"),this.impact2=game.add.audio("impact2"),this.jump=game.add.audio("jump"),this.start1=game.add.audio("start1"),this.surprise1=game.add.audio("surprise1"),this.impact2.onStop.add(this.soundStopped,this),this.back=game.add.audio("back"),this.fall=game.add.audio("fall"),this.block=game.add.emitter(0,0,10),this.block.makeParticles("block"),this.block.gravity=300,this.highscoreLabelTitle=game.add.text(60,0,"HIGH SCORE",{font:"16px Arial Black",fill:"#fff"}),this.highscoreLabelTitle.anchor.set(.5),this.highscoreLabelTitle.position.y=20,this.highscoreLabel=game.add.text(0,20,""+this.highscore,{font:"16px Arial Black",fill:"#fff"}),this.highscoreLabel.anchor.set(.5),this.highscoreLabel.stroke="#de77ae",this.highscoreLabel.strokeThickness=4,this.highscoreLabel.setShadow(2,2,"#333333",2,!0,!1),this.highscoreLabelTitle.addChild(this.highscoreLabel),localStorage.setItem("uphs","0"),this.clusterEmitter=game.add.emitter(0,0,100),this.clusterEmitter.makeParticles(["cluster0","cluster1","cluster2","cluster3","cluster4"]),this.clusterEmitter.width=game.world.width,this.clusterEmitter.x=game.world.centerX,this.clusterEmitter.y=this.highscoreLabel.position.y,0!=this.uphs){this.clusterEmitter.start(!1,4e3,100),this.initialHighScoreLabelPos=this.highscoreLabel.position.y;var g=game.add.tween(this.highscoreLabel).to({y:this.initialHighScoreLabelPos-20},100,"Quart.easeOut",!0,1e3),m=game.add.tween(this.highscoreLabel).to({y:this.initialHighScoreLabelPos},400,Phaser.Easing.Bounce.Out);g.chain(m),g.onComplete.add(this.repeatJump,this);var c=game.time.create(!1);c.loop(100,this.updateHighscoreLabelTint,this),c.start()}},e.prototype.updateHighscoreLabelTint=function(){this.highscoreLabelTitle.tint=16777215*Math.random()},e.prototype.repeatJump=function(){var a=game.add.tween(this.highscoreLabel).to({y:this.initialHighScoreLabelPos-20},100,"Quart.easeOut",!0,1e3),t=game.add.tween(this.highscoreLabel).to({y:this.initialHighScoreLabelPos},400,Phaser.Easing.Bounce.Out);a.chain(t),a.onComplete.add(this.repeatJump,this)},e.prototype.soundStopped=function(){this.explosion1.play()},e.prototype.updateAsktaps=function(){0==this.uphs?this.asktaps.exists?this.asktaps.kill():this.asktaps.revive():this.areyouhappy.exists?this.areyouhappy.kill():this.areyouhappy.revive()},e.prototype.reflect=function(a,e){if(!this.isShaked){this.addQuake(),this.executeFlash(),this.isShaked=!0,this.player.animations.stop(),this.mode=t.GAMEOVER;for(var i=0;i<this.arrayOfObstacles.length;i++){var s=this.arrayOfObstacles[i],r=s.getChildAt(0);if(s.body.enable=!1,r.body.enable=!1,-50<=s.position.x&&s.position.x<game.world.width+50&&game.add.tween(s).to({y:2*game.world.height},1e4,Phaser.Easing.Bounce.Out,!0),-50<=r.position.x&&r.position.x<game.world.width+50){game.add.tween(r).to({y:2*game.world.height},1e4,Phaser.Easing.Bounce.Out,!0);var o=this.arrayOfSmog[i];o.revive(),o.bringToTop(),o.position.x=s.position.x,o.position.y=440,game.add.tween(o).to({alpha:0},6e3,"Linear",!0)}}this.displayScoreboard()}},e.prototype.displayScoreboard=function(){var a=this;if(!(this.arrayOfTracking4DisplayPosY.length<=0)){var t=3;this.graphbar.lineStyle(t,16777215);var e=320,i=180,s=e/this.arrayOfTracking4DisplayPosY.length,r=1,o=[];if(0>=s){r=game.math.ceilTo(1/s);for(var h=0,l=0;this.arrayOfTracking4DisplayPosY.length;l++)l%r==0&&(o.push(h/r),h=0),h+=this.arrayOfTracking4DisplayPosY[l];h>0&&o.push(h/(this.arrayOfTracking4DisplayPosY.length%r)),s=0>s?1:e/this.arrayOfTracking4DisplayPosY.length}else o=this.arrayOfTracking4DisplayPosY.concat();var d,p=80,n=240,g=1;g=o.length>20?1:g,this.graphbar.moveTo(p,(1-i/o[0])*i+n);for(var l=1;l<o.length;l++)d=(1-i/o[l])*i,this.graphbar.lineTo(s*l+p,d+n),t*=g,this.graphbar.lineStyle(t,16777215);this.graphbar_arrowHead.beginFill(16777215),this.graphbar_arrowHead.lineStyle(5,16777215),this.graphbar_arrowHead.position.x=s*(o.length-1)+p,this.graphbar_arrowHead.position.y=d+n,this.graphbar_arrowHead.moveTo(0,0),this.graphbar_arrowHead.lineTo(-5,-5),this.graphbar_arrowHead.lineTo(5,-5),this.graphbar_arrowHead.endFill(),this.graphbar_arrowHead.rotation=game.math.angleBetween(o[o.length-1],o[o.length-1],s*(o.length-1)*p,d+n)+game.math.degToRad(-90);for(var m=0,c=0,l=0;l<this.arrayOfTracking4DisplayPosY.length;l++)m+=game.world.height-this.arrayOfTracking4DisplayPosY[l]-this.initPosOfPlayerY;c=game.math.floorTo(m/this.arrayOfTracking4DisplayPosY.length);for(var y=this.score+c,u="¥ "+String(y).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"),f=28,b=36,l=0;l<u.length;l++){var w=u.charAt(l),k=game.add.text(1.2*l+l*f+game.world.width/2-100,250,w,{font:"bold "+b+"px Arial Black",fill:"#fff",boundsAlignH:"center",boundsAlignV:"middle"});k.stroke="#de77ae",k.strokeThickness=8,k.setShadow(2,2,"#333333",2,!0,!1),this.dummyScoreBoard.addChild(k)}this.dummyScoreBoard.position.y-=80,this.dummyScoreBoard.position.x=game.world.width+game.world.centerX,this.dummyScoreBoard.alpha=1,this.woman.position.y=game.world.height-250,this.woman.position.x=100,this.woman.alpha=0,game.add.tween(this.dummyScoreBoard).to({x:0},1e3,Phaser.Easing.Bounce.In,!0),game.add.tween(this.woman).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0),game.add.tween(this.grayout).to({alpha:.7},800,Phaser.Easing.Linear.None,!0);var O=game.time.create(!1);O.add(500,function(){a.surprise1.play()}),O.start(),y>this.highscore&&(localStorage.setItem("highscore",""+y),localStorage.setItem("uphs","1"))}},e.prototype.executeFlash=function(){var a=game.add.tween(this.redFlash).to({alpha:1},100,Phaser.Easing.Bounce.Out),t=game.add.tween(this.redFlash).to({alpha:0},10,Phaser.Easing.Bounce.Out);a.chain(t),a.start(),this.player.scale.y=1,this.player.body.setSize(25,25,0,0)},e.prototype.hitWithObscales=function(a,e){this.isBlink||(this.impact1.play(),this.executeFlash(),this.player.animations.stop(),this.player.angle=90,this.mode=t.GAMEOVER,this.isBlink=!0,this.block.x=this.player.position.x+16,this.block.y=this.player.position.y,this.block.start(!0,2e3,null,10),this.fall.stop(),game.time.events.add(2e3,this.destroyEmitter,this))},e.prototype.destroyEmitter=function(){this.block.destroy()},e.prototype.hitScoreBar=function(a,t){this.passed1.play(),this.score+=1e3,this.months++;var e=t;e.body.enable=!1},e.prototype.update=function(){if(game.physics.arcade.collide(this.player,this.ground,null,this.reflect,this),this.mode==t.RUNNING){this.hudMonth.setText(""+this.months);for(var a=0;a<this.arrayOfObstacles.length;a++){var e=this.arrayOfObstacles[a];game.physics.arcade.collide(this.player,e,null,this.hitWithObscales,this);var i=e.getChildAt(0);game.physics.arcade.collide(this.player,i,null,this.hitWithObscales,this);var s=e.getChildAt(1);game.physics.arcade.overlap(this.player,s,null,this.hitScoreBar,this)}this.background.tilePosition.x-=.1,this.ground.tilePosition.x-=1,this.player.body.velocity.y>=0&&(0<=this.player.angle&&this.player.angle<180&&(this.speedOfRotation*=1.05,this.player.angle+=this.speedOfRotation),this.fall.isPlaying||0!=this.isBlink||this.fall.play()),this.arrayOfObstacles.forEach(function(a){if(a.position.x<=0){a.position.x=1500,a.position.y=game.rnd.integerInRange(-100,100);var t=a.getChildAt(1);t.body.enable=!0}a.position.x--});for(var a=0;a<this.arrayOfTracking4DisplayPosX.length;a++)this.arrayOfTracking4DisplayPosX[a]--,this.arrayOfTracking4DisplayPosX[a]<0&&(this.indexOfDrawStart=a);this.graphics_arrow.clear(),this.graphics_arrow.lineStyle(20,3407616),this.graphics_arrow.moveTo(this.arrayOfTracking4DisplayPosX[this.indexOfDrawStart],this.arrayOfTracking4DisplayPosY[this.indexOfDrawStart]);for(var a=this.indexOfDrawStart+1;a<this.arrayOfTracking4DisplayPosX.length;a++)this.graphics_arrow.lineTo(this.arrayOfTracking4DisplayPosX[a],this.arrayOfTracking4DisplayPosY[a]);this.graphics_arrow.lineTo(this.player.position.x,this.player.position.y),this.graphics_arrow_head.clear();var r=this.arrayOfTracking4DisplayPosX.length-1;this.graphics_arrow_head.beginFill(16724736),this.graphics_arrow_head.lineStyle(20,3407616),this.graphics_arrow_head.position.x=this.player.position.x,this.graphics_arrow_head.position.y=this.player.position.y,this.graphics_arrow_head.moveTo(0,0),this.graphics_arrow_head.lineTo(-10,-10),this.graphics_arrow_head.lineTo(10,-10),this.graphics_arrow_head.endFill(),this.graphics_arrow_head.rotation=game.math.angleBetween(this.arrayOfTracking4DisplayPosX[r],this.arrayOfTracking4DisplayPosY[r],this.player.position.x,this.player.position.y)+game.math.degToRad(-90)}},e.prototype.tapped=function(a,e){switch(this.mode){case t.STANBY:this.clusterEmitter.destroy(),this.asktapsTimer.stop(),this.start1.play(),this.flappychartlogo.alpha=0,this.player.animations.add("walk"),this.player.animations.play("walk",20,!0),this.initPosOfPlayerY=0,game.physics.arcade.gravity.y=1e3,this.asktaps.alpha=0,this.areyouhappy.alpha=0,this.player.anchor.set(.5),this.player.scale.y=.5,this.player.scale.x=1,this.player.position.x=game.world.centerX,this.player.position.y=game.world.centerY,this.arrayOfTracking4DisplayPosX.push(this.player.position.x),this.arrayOfTracking4DisplayPosY.push(this.player.position.y),this.monthcard.alpha=1,this.highscoreLabel.alpha=0,this.highscoreLabelTitle.alpha=0,this.mode=t.RUNNING,this.player.body.velocity.y=-400;break;case t.RUNNING:if(this.player.position.y<=0)break;this.fall.stop(),this.player.angle=0,this.speedOfRotation=1,this.player.body.velocity.y=-400,this.arrayOfTracking4DisplayPosX.push(this.player.position.x),this.arrayOfTracking4DisplayPosY.push(this.player.position.y),this.jump.play();break;default:this.isShaked=!1,this.isBlink=!1,game.state.restart(!0,!1),this.explosion1.stop(),this.back.play()}},e.prototype.render=function(){},e.prototype.addQuake=function(){this.impact2.play();var a=10,t={y:game.camera.y-a},e=100,i=Phaser.Easing.Bounce.InOut,s=!1,r=0,o=!0,h=game.add.tween(game.camera).to(t,e,i,s,r,4,o);h.start()},e}(Phaser.State);a.GameState=s}(FlappyChart||(FlappyChart={}));var game=new Phaser.Game(480,480,Phaser.AUTO,"screen");game.state.add("BootState",new FlappyChart.BootState),game.state.add("LoadingState",new FlappyChart.LoadingState),game.state.add("GameState",new FlappyChart.GameState),game.state.start("BootState",!0,!1);